({607:function(){var e=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(r,i){function l(e){try{s(n.next(e))}catch(e){i(e)}}function a(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(l,a)}s((n=n.apply(e,t||[])).next())}))};const t=e=>{let[t,o]=e.split(":").map((e=>parseInt(e)));const n=t>=12?"PM":"AM";return t>=13&&(t-=12),`${t}:${String(o).padStart(2,"0")} ${n}`},o=new Set,n=new Set,r=new Map,i=new Map,l=()=>{const e=Math.floor(360*Math.random());return{accent:`hsla(${e}, 70%,  70%, 0.8)`,light:`hsla(${e}, 70%,  70%, 0.5)`}},a=e=>{i.has(e)||i.set(e,l())},s={PIXELS_PER_HOUR:null,INITIAL_PIXELS:null,SLOT_WIDTH:175,RIGHT_MARGIN:5,BLOCK_CONTAINER:null,SELECT_BUILDING:null,SELECT_WEEKDAY:null},d=String.raw`https://portalapi2.uwaterloo.ca/v2/map/OpenClassrooms`,c=()=>e(this,void 0,void 0,(function*(){try{const e=yield fetch(d,{credentials:"include",method:"GET"});return yield e.json()}catch(e){throw alert("Could not get data from API."),e}})),u=(e,t,o,n,r,i,l,a,s)=>`\n    <div class="slot-block" style="background-color: ${n}; top: ${e}px; height: ${t}px; left: ${o}px;">\n        <div class="slot-block-inner">\n            <span>${i} ${l}</span>\n            <span>${a} to ${s}</span>\n            <span>${r}</span>\n        </div>\n    </div>\n    `,E=(e,o)=>{var n;const a=s.INITIAL_PIXELS;if(null===a)throw new Error("Failed rendering, could not get INITIAL_PIXELS.");const d=s.PIXELS_PER_HOUR;if(null===d)throw new Error("Failed rendering, could not get PIXELS_PER_HOUR.");const c=s.BLOCK_CONTAINER;if(null===c)throw new Error("Failed rending, could not find BLOCK_CONATINER.");c.innerHTML="";const E=0!==o.size,f=[];for(const t of r.entries())if(!E||o.has(t[0]))for(const o of e){const e=t[1].weeklySlots.get(o);if(void 0!==e)if(0!==e.length)for(const t of e)f.push(t);else console.log("The building",t[0],"has no available rooms on",o.toLowerCase(),"due to array of length 0.");else console.log("The building",t[0],"has no available rooms on",o.toLowerCase(),"due to undefined value.")}if(0===f.length)return void console.log("No intervals to render. Received:",e,o);const m=f.sort(((e,t)=>e.startNumber<t.startNumber?-1:e.startNumber>t.startNumber?1:0));let h=1;m[0].color=h;const p=[m[0].endNumber];for(let e=0;e<m.length;e++){let t=!1;for(let o=1;o<=h;o++)if(p[o]<=m[e].startNumber){m[e].color=o,p[o]=m[e].endNumber,t=!0;break}t||(h+=1,m[e].color=h,p[h]=m[e].endNumber)}for(const e of m){const[o,r]=e.StartTime.split(":").map((e=>parseInt(e))),[E,f]=e.EndTime.split(":").map((e=>parseInt(e)));if(null===e.color)throw new Error("Failed rendering, interval was not colored.");const m=a+(o-8+r/60)*d,h=d*(E-o+(f-r)/60),p=(e.color-2)*(s.SLOT_WIDTH+s.RIGHT_MARGIN),v=null!==(n=i.get(e.buildingName))&&void 0!==n?n:l(),w=u(Math.floor(m),Math.ceil(h),Math.round(p),v.accent,e.buildingName,e.buildingCode,e.roomNumber,t(e.StartTime),t(e.EndTime));c.insertAdjacentHTML("afterbegin",w)}},f=()=>{if(null===s.SELECT_BUILDING)throw new Error("Could not find building selector.");if(null===s.SELECT_WEEKDAY)throw new Error("Could not find weekday selector.");s.SELECT_BUILDING.insertAdjacentHTML("afterbegin",'<option value="---">--- any ---</option>');for(const e of n){const t=`<option value="${e}">${e}</option>`;s.SELECT_BUILDING.insertAdjacentHTML("afterbegin",t)}for(const e of o){const t=`<option value="${e}">${e}</option>`;s.SELECT_WEEKDAY.insertAdjacentHTML("afterbegin",t)}s.SELECT_BUILDING.addEventListener("change",(function(){var e;const t=null===(e=s.SELECT_WEEKDAY)||void 0===e?void 0:e.value;if(void 0===t)throw new Error("Could not get selected weekday.");"---"===this.value?E([t],new Set):E([t],new Set([this.value]))})),s.SELECT_WEEKDAY.addEventListener("change",(function(){var e;const t=null===(e=s.SELECT_BUILDING)||void 0===e?void 0:e.value;if(void 0===t)throw new Error("Could not get selected weekday.");E([this.value],"---"===t?new Set:new Set([t]))}));const e=s.SELECT_WEEKDAY.value;E([e],new Set)};!function(){var t;e(this,void 0,void 0,(function*(){const e=yield c();if(200!==e.meta.status)throw console.error(e.meta),new Error("Response was not status code 200.");for(const l of e.data.features){const e=l.properties,s=e.buildingName,d=e.buildingCode;if(!e.supportOpenClassroom){console.log(`The building ${s} does not support OpenClassroom.`);continue}n.add(s);const c=(i=e.openClassroomSlots,JSON.parse(i)),u={name:s,code:d,weeklySlots:new Map};for(const e of c.data){const n=e.roomNumber;for(const r of e.Schedule){const e=r.Weekday;o.add(e);for(const o of r.Slots){const r=u.weeklySlots;r.has(e)?null===(t=r.get(e))||void 0===t||t.push({color:null,buildingName:s,buildingCode:d,roomNumber:n,StartTime:o.StartTime,EndTime:o.EndTime,startNumber:o.StartTime.split(":").reduce(((e,t)=>100*e+Number(t)),0),endNumber:o.EndTime.split(":").reduce(((e,t)=>100*e+Number(t)),0)}):r.set(e,[])}}}a(s),r.set(s,u)}var i;f()}))}();const m=t=>e(this,void 0,void 0,(function*(){yield new Promise((e=>setTimeout(e,t)))})),h=()=>e(this,void 0,void 0,(function*(){const e=s.INITIAL_PIXELS;if(null===e)throw new Error("Failed moving time pointer, could not get INITIAL_PIXELS.");const o=s.PIXELS_PER_HOUR;if(null===o)throw new Error("Failed moving time pointer, could not get PIXELS_PER_HOUR.");const n=document.querySelector("div.time-pointer");if(null===n)throw new Error("Cannot find time-pointer.");const r=n.querySelector("span");if(null===r)throw new Error("Cannot find time-span indicator.");const i=new Intl.DateTimeFormat([],{timeZone:"America/Toronto",hour:"2-digit",minute:"2-digit",hourCycle:"h24"}),l=n.getBoundingClientRect().height/2;for(;;){const s=i.format(new Date),[c,u]=s.split(":").map((e=>parseInt(e))),E=(a=(c-8+u/60)*o+e-l,d=e/2-1,761,Math.min(Math.max(a,d),761));n.style.setProperty("top",`${E}px`),r.innerText=t(s),yield m(6e4)}var a,d}));window.addEventListener("DOMContentLoaded",(()=>{var e;const t=null===(e=document.querySelector("div.day-time>div.time-row"))||void 0===e?void 0:e.getBoundingClientRect().height;if(void 0===t)throw new Error("Could not find required div.time-row HTMLElement.");s.PIXELS_PER_HOUR=t,s.INITIAL_PIXELS=t/2,s.BLOCK_CONTAINER=document.querySelector("div.day-blocks>div.block-container"),s.SELECT_BUILDING=document.querySelector("select#buildings-selector"),s.SELECT_WEEKDAY=document.querySelector("select#weekday-selector"),h()}))}})[607]();
//# sourceMappingURL=main.js.map