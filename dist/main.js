({607:function(){var e=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(r,i){function l(e){try{a(n.next(e))}catch(e){i(e)}}function s(e){try{a(n.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(l,s)}a((n=n.apply(e,t||[])).next())}))};const t=e=>{let[t,o]=e.split(":").map((e=>parseInt(e)));const n=t>=12?"PM":"AM";return t>=13&&(t-=12),`${t}:${String(o).padStart(2,"0")} ${n}`},o=new Set,n=new Set,r=new Map,i=new Map,l=()=>{const e=Math.floor(360*Math.random());return{accent:`hsla(${e}, 70%,  70%, 0.8)`,light:`hsla(${e}, 70%,  70%, 0.5)`}},s=e=>{i.has(e)||i.set(e,l())},a={PIXELS_PER_HOUR:null,INITIAL_PIXELS:null,SLOT_WIDTH:175,RIGHT_MARGIN:5,BLOCK_CONTAINER:null,SELECT_BUILDING:null,SELECT_WEEKDAY:null},d=String.raw`https://corsproxy.io/?https://portalapi2.uwaterloo.ca/v2/map/OpenClassrooms`,c=()=>e(this,void 0,void 0,(function*(){try{const e=yield fetch(d,{method:"GET"});return yield e.json()}catch(e){throw alert("Could not get data from API."),e}})),u=(e,t,o,n,r,i,l,s,a)=>`\n    <div class="slot-block" style="background-color: ${n}; top: ${e}px; height: ${t}px; left: ${o}px;">\n        <div class="slot-block-inner">\n            <span>${i} ${l}</span>\n            <span>${s} to ${a}</span>\n            <span>${r}</span>\n        </div>\n    </div>\n    `,E=(e,o)=>{var n;const s=a.INITIAL_PIXELS;if(null===s)throw new Error("Failed rendering, could not get INITIAL_PIXELS.");const d=a.PIXELS_PER_HOUR;if(null===d)throw new Error("Failed rendering, could not get PIXELS_PER_HOUR.");const c=a.BLOCK_CONTAINER;if(null===c)throw new Error("Failed rending, could not find BLOCK_CONATINER.");c.innerHTML="";const E=0!==o.size,m=[];for(const t of r.entries())if(!E||o.has(t[0]))for(const o of e){const e=t[1].weeklySlots.get(o);if(void 0!==e)if(0!==e.length)for(const t of e)m.push(t);else console.log("The building",t[0],"has no available rooms on",o.toLowerCase(),"due to array of length 0.");else console.log("The building",t[0],"has no available rooms on",o.toLowerCase(),"due to undefined value.")}if(0===m.length)return void console.log("No intervals to render. Received:",e,o);const f=m.sort(((e,t)=>{if(e.startNumber<t.startNumber)return-1;if(e.startNumber>t.startNumber)return 1;{const o=e.endNumber-e.startNumber;return t.endNumber-t.startNumber-o}}));let h=1;f[0].color=h;const p=[f[0].endNumber];for(let e=0;e<f.length;e++){let t=!1;for(let o=1;o<=h;o++)if(p[o]<=f[e].startNumber){f[e].color=o,p[o]=f[e].endNumber,t=!0;break}t||(h+=1,f[e].color=h,p[h]=f[e].endNumber)}for(const e of f){const[o,r]=e.StartTime.split(":").map((e=>parseInt(e))),[E,m]=e.EndTime.split(":").map((e=>parseInt(e)));if(null===e.color)throw new Error("Failed rendering, interval was not colored.");const f=s+(o-8+r/60)*d,h=d*(E-o+(m-r)/60),p=(e.color-2)*(a.SLOT_WIDTH+a.RIGHT_MARGIN),v=null!==(n=i.get(e.buildingName))&&void 0!==n?n:l(),w=u(Math.floor(f),Math.ceil(h),Math.round(p),v.accent,e.buildingName,e.buildingCode,e.roomNumber,t(e.StartTime),t(e.EndTime));c.insertAdjacentHTML("afterbegin",w)}},m=()=>{if(null===a.SELECT_BUILDING)throw new Error("Could not find building selector.");if(null===a.SELECT_WEEKDAY)throw new Error("Could not find weekday selector.");a.SELECT_BUILDING.insertAdjacentHTML("afterbegin",'<option value="---" selected="selected">--- any ---</option>');for(const e of n){const t=`<option value="${e}">${e}</option>`;a.SELECT_BUILDING.insertAdjacentHTML("afterbegin",t)}let e=0;for(const t of o){const o=`<option value="${t}" ${0===e?'selected="selected"':""}>${t}</option>`;a.SELECT_WEEKDAY.insertAdjacentHTML("afterbegin",o),e+=1}a.SELECT_BUILDING.addEventListener("change",(function(){var e;const t=null===(e=a.SELECT_WEEKDAY)||void 0===e?void 0:e.value;if(void 0===t)throw new Error("Could not get selected weekday.");"---"===this.value?E([t],new Set):E([t],new Set([this.value]))})),a.SELECT_WEEKDAY.addEventListener("change",(function(){var e;const t=null===(e=a.SELECT_BUILDING)||void 0===e?void 0:e.value;if(void 0===t)throw new Error("Could not get selected weekday.");E([this.value],"---"===t?new Set:new Set([t]))}));const t=a.SELECT_WEEKDAY.value;E([t],new Set)};!function(){var t;e(this,void 0,void 0,(function*(){const e=yield c();if(200!==e.meta.status)throw console.error(e.meta),new Error("Response was not status code 200.");for(const l of e.data.features){const e=l.properties,a=e.buildingName,d=e.buildingCode;if(!e.supportOpenClassroom){console.log(`The building ${a} does not support OpenClassroom.`);continue}n.add(a);const c=(i=e.openClassroomSlots,JSON.parse(i)),u={name:a,code:d,weeklySlots:new Map};for(const e of c.data){const n=e.roomNumber;for(const r of e.Schedule){const e=r.Weekday;o.add(e);for(const o of r.Slots){const r=u.weeklySlots;r.has(e)?null===(t=r.get(e))||void 0===t||t.push({color:null,buildingName:a,buildingCode:d,roomNumber:n,StartTime:o.StartTime,EndTime:o.EndTime,startNumber:o.StartTime.split(":").reduce(((e,t)=>100*e+Number(t)),0),endNumber:o.EndTime.split(":").reduce(((e,t)=>100*e+Number(t)),0)}):r.set(e,[])}}}s(a),r.set(a,u)}var i;m()}))}();const f=t=>e(this,void 0,void 0,(function*(){yield new Promise((e=>setTimeout(e,t)))})),h=()=>e(this,void 0,void 0,(function*(){const e=a.INITIAL_PIXELS;if(null===e)throw new Error("Failed moving time pointer, could not get INITIAL_PIXELS.");const o=a.PIXELS_PER_HOUR;if(null===o)throw new Error("Failed moving time pointer, could not get PIXELS_PER_HOUR.");const n=document.querySelector("div.time-pointer");if(null===n)throw new Error("Cannot find time-pointer.");const r=n.querySelector("span");if(null===r)throw new Error("Cannot find time-span indicator.");const i=new Intl.DateTimeFormat([],{timeZone:"America/Toronto",hour:"2-digit",minute:"2-digit",hourCycle:"h24"}),l=n.getBoundingClientRect().height/2;for(;;){const a=i.format(new Date),[c,u]=a.split(":").map((e=>parseInt(e))),E=(s=(c-8+u/60)*o+e-l,d=e/2-1,761,Math.min(Math.max(s,d),761));n.style.setProperty("top",`${E}px`),r.innerText=t(a),yield f(6e4)}var s,d}));window.addEventListener("DOMContentLoaded",(()=>{var e;const t=null===(e=document.querySelector("div.day-time>div.time-row"))||void 0===e?void 0:e.getBoundingClientRect().height;if(void 0===t)throw new Error("Could not find required div.time-row HTMLElement.");a.PIXELS_PER_HOUR=t,a.INITIAL_PIXELS=t/2,a.BLOCK_CONTAINER=document.querySelector("div.day-blocks>div.block-container"),a.SELECT_BUILDING=document.querySelector("select#buildings-selector"),a.SELECT_WEEKDAY=document.querySelector("select#weekday-selector"),h()}))}})[607]();
//# sourceMappingURL=main.js.map